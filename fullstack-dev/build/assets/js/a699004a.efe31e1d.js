"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[8281],{1892:e=>{e.exports=JSON.parse('{"permalink":"/fullstack-dev/blog/ELASTICSEARCH_SETUP","editUrl":"https://github.com/tamnk74/fullstack-dev/tree/main/docs-site/blog/ELASTICSEARCH_SETUP.md","source":"@site/blog/ELASTICSEARCH_SETUP.md","title":"Elasticsearch Full-Text Search Setup","description":"This guide will help you set up Elasticsearch for full-text search functionality in your Next.js application.","date":"2025-10-01T16:11:37.000Z","tags":[],"readingTime":4.37,"hasTruncateMarker":true,"authors":[],"frontMatter":{},"unlisted":false,"nextItem":{"title":"SEO Implementation Guide","permalink":"/fullstack-dev/blog/SEO_IMPLEMENTATION"}}')},2e3:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>o});var s=i(1892),l=i(5813),t=i(7814);const c={},r="Elasticsearch Full-Text Search Setup",a={authorsImageUrls:[]},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"1. Install Elasticsearch",id:"1-install-elasticsearch",level:2},{value:"Option A: Using Docker (Recommended for development)",id:"option-a-using-docker-recommended-for-development",level:3},{value:"Option B: Local Installation",id:"option-b-local-installation",level:3},{value:"2. Environment Variables",id:"2-environment-variables",level:2},{value:"3. Initialize the Index",id:"3-initialize-the-index",level:2},{value:"Option A: Using the Web Interface (Development)",id:"option-a-using-the-web-interface-development",level:3},{value:"Option B: Using the Setup Script",id:"option-b-using-the-setup-script",level:3},{value:"Option C: Using the API Endpoint",id:"option-c-using-the-api-endpoint",level:3},{value:"4. Features",id:"4-features",level:2},{value:"Search Functionality",id:"search-functionality",level:3},{value:"Search Features",id:"search-features",level:3},{value:"5. API Endpoints",id:"5-api-endpoints",level:2},{value:"Search Posts",id:"search-posts",level:3},{value:"Initialize Elasticsearch",id:"initialize-elasticsearch",level:3},{value:"Sync Posts to Elasticsearch",id:"sync-posts-to-elasticsearch",level:3},{value:"6. Automatic Indexing",id:"6-automatic-indexing",level:2},{value:"Manual Sync",id:"manual-sync",level:3},{value:"Using the API",id:"using-the-api",level:4},{value:"Using the Sync Service",id:"using-the-sync-service",level:4},{value:"Monitoring Indexing",id:"monitoring-indexing",level:3},{value:"7. Troubleshooting",id:"7-troubleshooting",level:2},{value:"Elasticsearch not connecting",id:"elasticsearch-not-connecting",level:3},{value:"Search not working",id:"search-not-working",level:3},{value:"Performance Issues",id:"performance-issues",level:3},{value:"8. Production Deployment",id:"8-production-deployment",level:2},{value:"Elasticsearch Service",id:"elasticsearch-service",level:3},{value:"Environment Variables for Production",id:"environment-variables-for-production",level:3},{value:"Security Considerations",id:"security-considerations",level:3},{value:"9. Monitoring and Maintenance",id:"9-monitoring-and-maintenance",level:2},{value:"Health Checks",id:"health-checks",level:3},{value:"Index Maintenance",id:"index-maintenance",level:3},{value:"10. Customization",id:"10-customization",level:2},{value:"Search Configuration",id:"search-configuration",level:3},{value:"UI Customization",id:"ui-customization",level:3},{value:"Support",id:"support",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"This guide will help you set up Elasticsearch for full-text search functionality in your Next.js application."}),"\n",(0,l.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Node.js and npm/yarn installed"}),"\n",(0,l.jsx)(n.li,{children:"Next.js application running"}),"\n",(0,l.jsx)(n.li,{children:"Supabase database with posts"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"1-install-elasticsearch",children:"1. Install Elasticsearch"}),"\n",(0,l.jsx)(n.h3,{id:"option-a-using-docker-recommended-for-development",children:"Option A: Using Docker (Recommended for development)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Start Elasticsearch with Docker\ndocker run -d \\\n  --name elasticsearch \\\n  -p 9200:9200 \\\n  -e "discovery.type=single-node" \\\n  -e "xpack.security.enabled=false" \\\n  elasticsearch:8.11.0\n\n# Verify Elasticsearch is running\ncurl http://localhost:9200\n'})}),"\n",(0,l.jsx)(n.h3,{id:"option-b-local-installation",children:"Option B: Local Installation"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Download Elasticsearch from ",(0,l.jsx)(n.a,{href:"https://www.elastic.co/downloads/elasticsearch",children:"elastic.co"})]}),"\n",(0,l.jsx)(n.li,{children:"Follow the installation guide for your operating system"}),"\n",(0,l.jsx)(n.li,{children:"Start Elasticsearch service"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"2-environment-variables",children:"2. Environment Variables"}),"\n",(0,l.jsxs)(n.p,{children:["Add these environment variables to your ",(0,l.jsx)(n.code,{children:".env.local"})," file:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-env",children:"# Elasticsearch Configuration\nELASTICSEARCH_URL=http://localhost:9200\nELASTICSEARCH_POSTS_INDEX=posts\n\n# Optional: Authentication (if your Elasticsearch requires auth)\n# ELASTICSEARCH_USERNAME=your_username\n# ELASTICSEARCH_PASSWORD=your_password\n# ELASTICSEARCH_APIKEY=your_api_key\n"})}),"\n",(0,l.jsx)(n.h2,{id:"3-initialize-the-index",children:"3. Initialize the Index"}),"\n",(0,l.jsx)(n.h3,{id:"option-a-using-the-web-interface-development",children:"Option A: Using the Web Interface (Development)"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Go to your posts page (",(0,l.jsx)(n.code,{children:"/posts"}),")"]}),"\n",(0,l.jsx)(n.li,{children:'In the debug section, click "Check Status" to verify Elasticsearch connection'}),"\n",(0,l.jsx)(n.li,{children:'Click "Initialize Index" to create the index and bulk import existing posts'}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"option-b-using-the-setup-script",children:"Option B: Using the Setup Script"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Run the setup script\nnpx tsx scripts/setup-elasticsearch.ts\n\n# Or add to package.json scripts:\n# "setup:elasticsearch": "tsx scripts/setup-elasticsearch.ts"\n# Then run: npm run setup:elasticsearch\n'})}),"\n",(0,l.jsx)(n.h3,{id:"option-c-using-the-api-endpoint",children:"Option C: Using the API Endpoint"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check Elasticsearch status\ncurl http://localhost:3000/api/elasticsearch/init\n\n# Initialize the index\ncurl -X POST http://localhost:3000/api/elasticsearch/init\n"})}),"\n",(0,l.jsx)(n.h2,{id:"4-features",children:"4. Features"}),"\n",(0,l.jsx)(n.h3,{id:"search-functionality",children:"Search Functionality"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Full-text search"}),": Search across post titles and content"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Fuzzy matching"}),": Handles typos and similar words"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Highlighting"}),": Search terms are highlighted in results"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Fallback"}),": Falls back to database search if Elasticsearch is unavailable"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Responsive"}),": Search bar available in navbar on desktop and mobile"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"search-features",children:"Search Features"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Keyboard shortcut"}),": Press ",(0,l.jsx)(n.code,{children:"Cmd+K"})," (Mac) or ",(0,l.jsx)(n.code,{children:"Ctrl+K"})," (Windows/Linux) to focus search"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Real-time results"}),": Search results update as you type"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Pagination"}),": Large result sets are paginated"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Sorting"}),": Results sorted by relevance score and creation date"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"5-api-endpoints",children:"5. API Endpoints"}),"\n",(0,l.jsx)(n.h3,{id:"search-posts",children:"Search Posts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"GET /api/posts/search?q=search_term&page=1&limit=10\n"})}),"\n",(0,l.jsx)(n.h3,{id:"initialize-elasticsearch",children:"Initialize Elasticsearch"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"GET /api/elasticsearch/init    # Check status\nPOST /api/elasticsearch/init   # Initialize index\n"})}),"\n",(0,l.jsx)(n.h3,{id:"sync-posts-to-elasticsearch",children:"Sync Posts to Elasticsearch"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"GET /api/elasticsearch/sync     # Health check and endpoints info\nPOST /api/elasticsearch/sync?action=sync   # Sync all posts\nPOST /api/elasticsearch/sync?action=health # Health check only\n"})}),"\n",(0,l.jsx)(n.h2,{id:"6-automatic-indexing",children:"6. Automatic Indexing"}),"\n",(0,l.jsx)(n.p,{children:"Posts are automatically indexed in Elasticsearch when:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Creating a post"}),": New posts are indexed immediately after successful creation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Updating a post"}),": Modified posts are re-indexed with the latest content"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Deleting a post"}),": Posts are removed from the Elasticsearch index"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"The indexing happens automatically in the background and won't affect the user experience. If Elasticsearch is unavailable, the database operations will still succeed, and only a warning will be logged."}),"\n",(0,l.jsx)(n.h3,{id:"manual-sync",children:"Manual Sync"}),"\n",(0,l.jsx)(n.p,{children:"If you need to sync existing posts or re-index everything:"}),"\n",(0,l.jsx)(n.h4,{id:"using-the-api",children:"Using the API"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Check Elasticsearch health\ncurl http://localhost:3000/api/elasticsearch/sync\n\n# Sync all posts to Elasticsearch\ncurl -X POST "http://localhost:3000/api/elasticsearch/sync?action=sync"\n\n# Health check only\ncurl -X POST "http://localhost:3000/api/elasticsearch/sync?action=health"\n'})}),"\n",(0,l.jsx)(n.h4,{id:"using-the-sync-service",children:"Using the Sync Service"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { syncPostsToElasticsearch } from '@/shared/services/sync';\n\nconst result = await syncPostsToElasticsearch();\nconsole.log(`Synced ${result.syncedCount} posts`);\n"})}),"\n",(0,l.jsx)(n.h3,{id:"monitoring-indexing",children:"Monitoring Indexing"}),"\n",(0,l.jsx)(n.p,{children:"During development, you can monitor indexing in the browser console:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.code,{children:"Post indexed in Elasticsearch: 123"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.code,{children:"Post updated in Elasticsearch: 123"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.code,{children:"Post deleted from Elasticsearch: 123"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u26a0\ufe0f ",(0,l.jsx)(n.code,{children:"Failed to index post in Elasticsearch: [error details]"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"7-troubleshooting",children:"7. Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"elasticsearch-not-connecting",children:"Elasticsearch not connecting"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Verify Elasticsearch is running: ",(0,l.jsx)(n.code,{children:"curl http://localhost:9200"})]}),"\n",(0,l.jsxs)(n.li,{children:["Check environment variables in ",(0,l.jsx)(n.code,{children:".env.local"})]}),"\n",(0,l.jsxs)(n.li,{children:["Check Docker container status: ",(0,l.jsx)(n.code,{children:"docker ps"})]}),"\n",(0,l.jsxs)(n.li,{children:["View Docker logs: ",(0,l.jsx)(n.code,{children:"docker logs elasticsearch"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"search-not-working",children:"Search not working"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Check if index exists: Use the debug panel in ",(0,l.jsx)(n.code,{children:"/posts"})]}),"\n",(0,l.jsx)(n.li,{children:'Verify posts are indexed: Look for "posts indexed" message'}),"\n",(0,l.jsx)(n.li,{children:"Check browser console for JavaScript errors"}),"\n",(0,l.jsx)(n.li,{children:"Verify API endpoints are working"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Increase Elasticsearch memory: Add ",(0,l.jsx)(n.code,{children:'-e "ES_JAVA_OPTS=-Xms512m -Xmx512m"'})," to Docker command"]}),"\n",(0,l.jsxs)(n.li,{children:["Optimize search queries in ",(0,l.jsx)(n.code,{children:"elasticsearch.ts"})]}),"\n",(0,l.jsx)(n.li,{children:"Implement caching for frequently searched terms"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"8-production-deployment",children:"8. Production Deployment"}),"\n",(0,l.jsx)(n.h3,{id:"elasticsearch-service",children:"Elasticsearch Service"}),"\n",(0,l.jsx)(n.p,{children:"For production, consider using:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Elastic Cloud"}),": Managed Elasticsearch service"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"AWS OpenSearch"}),": Amazon's Elasticsearch service"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Self-hosted"}),": Deploy Elasticsearch on your own infrastructure"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"environment-variables-for-production",children:"Environment Variables for Production"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-env",children:"ELASTICSEARCH_URL=https://your-production-elasticsearch-url\nELASTICSEARCH_APIKEY=your-production-api-key\nELASTICSEARCH_POSTS_INDEX=production_posts\n"})}),"\n",(0,l.jsx)(n.h3,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Enable authentication on Elasticsearch"}),"\n",(0,l.jsx)(n.li,{children:"Use HTTPS for Elasticsearch connections"}),"\n",(0,l.jsx)(n.li,{children:"Restrict network access to Elasticsearch"}),"\n",(0,l.jsx)(n.li,{children:"Regularly update Elasticsearch version"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"9-monitoring-and-maintenance",children:"9. Monitoring and Maintenance"}),"\n",(0,l.jsx)(n.h3,{id:"health-checks",children:"Health Checks"}),"\n",(0,l.jsx)(n.p,{children:"The application includes health checks:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Elasticsearch availability check in search API"}),"\n",(0,l.jsx)(n.li,{children:"Fallback to database search if Elasticsearch is down"}),"\n",(0,l.jsx)(n.li,{children:"Status indicators in development debug panel"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"index-maintenance",children:"Index Maintenance"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Reindexing"}),": Use the initialize endpoint to rebuild the index"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Mapping updates"}),": Update the mapping in ",(0,l.jsx)(n.code,{children:"elasticsearch.ts"})," and reinitialize"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Performance monitoring"}),": Monitor query performance and optimize as needed"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"10-customization",children:"10. Customization"}),"\n",(0,l.jsx)(n.h3,{id:"search-configuration",children:"Search Configuration"}),"\n",(0,l.jsxs)(n.p,{children:["Edit ",(0,l.jsx)(n.code,{children:"src/shared/services/elasticsearch.ts"})," to customize:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Search fields and boost values"}),"\n",(0,l.jsx)(n.li,{children:"Highlighting settings"}),"\n",(0,l.jsx)(n.li,{children:"Fuzzy matching sensitivity"}),"\n",(0,l.jsx)(n.li,{children:"Result sorting criteria"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"ui-customization",children:"UI Customization"}),"\n",(0,l.jsx)(n.p,{children:"Edit components to customize:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/shared/ui/search-bar/index.tsx"}),": Search bar appearance"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/features/posts/list/ui.tsx"}),": Results display"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/app/[locale]/components/Navbar.tsx"}),": Navbar integration"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,l.jsx)(n.p,{children:"If you encounter issues:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Check the troubleshooting section above"}),"\n",(0,l.jsx)(n.li,{children:"Review Elasticsearch logs"}),"\n",(0,l.jsx)(n.li,{children:"Check browser console for errors"}),"\n",(0,l.jsx)(n.li,{children:"Verify environment variables are set correctly"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},7814:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>r});var s=i(9729);const l={},t=s.createContext(l);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);