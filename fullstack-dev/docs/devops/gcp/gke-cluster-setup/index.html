<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-devops/gcp/gke-cluster-setup" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">GKE Cluster Setup Guide | Full-Stack Developer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tamnk74.github.io/fullstack-dev/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tamnk74.github.io/fullstack-dev/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tamnk74.github.io/fullstack-dev/docs/devops/gcp/gke-cluster-setup"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GKE Cluster Setup Guide | Full-Stack Developer"><meta data-rh="true" name="description" content="A comprehensive guide to setting up and configuring Google Kubernetes Engine (GKE) clusters from scratch."><meta data-rh="true" property="og:description" content="A comprehensive guide to setting up and configuring Google Kubernetes Engine (GKE) clusters from scratch."><link data-rh="true" rel="icon" href="/fullstack-dev/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tamnk74.github.io/fullstack-dev/docs/devops/gcp/gke-cluster-setup"><link data-rh="true" rel="alternate" href="https://tamnk74.github.io/fullstack-dev/docs/devops/gcp/gke-cluster-setup" hreflang="en"><link data-rh="true" rel="alternate" href="https://tamnk74.github.io/fullstack-dev/docs/devops/gcp/gke-cluster-setup" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Google Cloud Platform (GCP)","item":"https://tamnk74.github.io/fullstack-dev/docs/devops/gcp/"},{"@type":"ListItem","position":2,"name":"GKE Cluster Setup Guide","item":"https://tamnk74.github.io/fullstack-dev/docs/devops/gcp/gke-cluster-setup"}]}</script><link rel="alternate" type="application/rss+xml" href="/fullstack-dev/blog/rss.xml" title="Full-Stack Developer RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/fullstack-dev/blog/atom.xml" title="Full-Stack Developer Atom Feed"><link rel="stylesheet" href="/fullstack-dev/assets/css/styles.60db8567.css">
<script src="/fullstack-dev/assets/js/runtime~main.87438347.js" defer="defer"></script>
<script src="/fullstack-dev/assets/js/main.9dc31388.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/fullstack-dev/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_DozU" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/fullstack-dev/"><div class="navbar__logo"><img src="/fullstack-dev/img/logo.svg" alt="Full-Stack Developer Logo" class="themedComponent_dued themedComponent--light_Jgez"><img src="/fullstack-dev/img/logo.svg" alt="Full-Stack Developer Logo" class="themedComponent_dued themedComponent--dark_OEZ1"></div><b class="navbar__title text--truncate">Full-Stack Developer</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/fullstack-dev/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/fullstack-dev/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_SFyi"><div class="navbar__search searchBarContainer_jFf1" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_mr2x" value=""><div class="loadingRing__lbt searchBarLoadingRing_pf7H"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/tamnk74/fullstack-dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_PqB4"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_WCEm colorModeToggle_eIxa"><button class="clean-btn toggleButton_nhoX toggleButtonDisabled_GPdO" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_BDuF lightToggleIcon_DH_d"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_BDuF darkToggleIcon_j7cc"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_BDuF systemToggleIcon_sRCC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_Inon"><div class="docsWrapper_vTcP"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Kk4I" type="button"></button><div class="docRoot_oC9v"><aside class="theme-doc-sidebar-container docSidebarContainer_o76a"><div class="sidebarViewport_X9l3"><div class="sidebar_nRMc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_QChV"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fullstack-dev/docs/intro"><span title="Introduction" class="linkLabel_ttjv">Introduction</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/fullstack-dev/docs/search-guide"><span title="Search Documentation" class="linkLabel_ttjv">Search Documentation</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/fullstack-dev/docs/setup"><span title="Getting Started" class="categoryLinkLabel_K4TR">Getting Started</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/fullstack-dev/docs/assessments/developer-assessment-with-development-plans"><span title="Career Development" class="categoryLinkLabel_K4TR">Career Development</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist" href="/fullstack-dev/docs/security-practices/"><span title="Security Practices" class="categoryLinkLabel_K4TR">Security Practices</span></a><button aria-label="Expand sidebar category &#x27;Security Practices&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist" href="/fullstack-dev/docs/qa-practices/"><span title="QA Practices" class="categoryLinkLabel_K4TR">QA Practices</span></a><button aria-label="Expand sidebar category &#x27;QA Practices&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist" href="/fullstack-dev/docs/architecture-practices/"><span title="Architecture Practices" class="categoryLinkLabel_K4TR">Architecture Practices</span></a><button aria-label="Expand sidebar category &#x27;Architecture Practices&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist" href="/fullstack-dev/docs/coding-conventions/"><span title="Coding Conventions" class="categoryLinkLabel_K4TR">Coding Conventions</span></a><button aria-label="Expand sidebar category &#x27;Coding Conventions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist" href="/fullstack-dev/docs/rag-recommendations/"><span title="RAG Recommendations" class="categoryLinkLabel_K4TR">RAG Recommendations</span></a><button aria-label="Expand sidebar category &#x27;RAG Recommendations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist" href="/fullstack-dev/docs/backend/"><span title="Backend" class="categoryLinkLabel_K4TR">Backend</span></a><button aria-label="Expand sidebar category &#x27;Backend&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/fullstack-dev/docs/ai-machine-learning/vertex-ai-gemini-guide"><span title="AI &amp; Machine Learning" class="categoryLinkLabel_K4TR">AI &amp; Machine Learning</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/fullstack-dev/docs/features"><span title="Features" class="categoryLinkLabel_K4TR">Features</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/fullstack-dev/docs/devops/gitops-microservices-gcp-guide"><span title="DevOps" class="categoryLinkLabel_K4TR">DevOps</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fullstack-dev/docs/devops/gitops-microservices-gcp-guide"><span title="GitOps Microservices Deployment Guide: Node.js on GCP GKE with Kustomize and ArgoCD" class="linkLabel_ttjv">GitOps Microservices Deployment Guide: Node.js on GCP GKE with Kustomize and ArgoCD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fullstack-dev/docs/devops/devsecops-toolset"><span title="DevSecOps Toolset for Ecommerce Application" class="linkLabel_ttjv">DevSecOps Toolset for Ecommerce Application</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--active" tabindex="0" href="/fullstack-dev/docs/devops/gcp/"><span title="Google Cloud Platform (GCP)" class="categoryLinkLabel_K4TR">Google Cloud Platform (GCP)</span></a><button aria-label="Collapse sidebar category &#x27;Google Cloud Platform (GCP)&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/fullstack-dev/docs/devops/gcp/gke-cluster-setup"><span title="GKE Cluster Setup Guide" class="linkLabel_ttjv">GKE Cluster Setup Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fullstack-dev/docs/devops/gcp/gke-ingress-setup"><span title="GKE Ingress Setup Guide" class="linkLabel_ttjv">GKE Ingress Setup Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/fullstack-dev/docs/devops/gcp/microservices-terraform-guide"><span title="Comprehensive Microservices Architecture on GCP with Terraform" class="linkLabel_ttjv">Comprehensive Microservices Architecture on GCP with Terraform</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/fullstack-dev/docs/testing"><span title="Development" class="categoryLinkLabel_K4TR">Development</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/fullstack-dev/docs/api-reference"><span title="API Reference" class="categoryLinkLabel_K4TR">API Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/fullstack-dev/docs/tutorial-basics/create-a-document"><span title="Tutorial" class="categoryLinkLabel_K4TR">Tutorial</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_AYZa menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/fullstack-dev/docs/tutorial-extras/manage-docs-versions"><span title="Advanced" class="categoryLinkLabel_K4TR">Advanced</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_Go1O"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_tbb6"><div class="docItemContainer_loSK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Lu9I" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/fullstack-dev/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_x1cF"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">DevOps</span></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/fullstack-dev/docs/devops/gcp/"><span>Google Cloud Platform (GCP)</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">GKE Cluster Setup Guide</span></li></ul></nav><div class="tocCollapsible_e8zW theme-doc-toc-mobile tocMobile_QFGV"><button type="button" class="clean-btn tocCollapsibleButton_N02v">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>GKE Cluster Setup Guide</h1></header>
<p>A comprehensive guide to setting up and configuring Google Kubernetes Engine (GKE) clusters from scratch.</p>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="table-of-contents">Table of Contents<a href="#table-of-contents" class="hash-link" aria-label="Direct link to Table of Contents" title="Direct link to Table of Contents" translate="no">​</a></h2>
<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#initial-setup">Initial Setup</a></li>
<li><a href="#terraform-setup">Terraform Setup</a></li>
<li><a href="#cluster-creation-options">Cluster Creation Options</a></li>
<li><a href="#standard-gke-cluster-setup">Standard GKE Cluster Setup</a></li>
<li><a href="#autopilot-gke-cluster-setup">Autopilot GKE Cluster Setup</a></li>
<li><a href="#node-pool-configuration">Node Pool Configuration</a></li>
<li><a href="#security-configuration">Security Configuration</a></li>
<li><a href="#networking-configuration">Networking Configuration</a></li>
<li><a href="#monitoring-and-logging">Monitoring and Logging</a></li>
<li><a href="#storage-configuration">Storage Configuration</a></li>
<li><a href="#cluster-management">Cluster Management</a></li>
<li><a href="#best-practices">Best Practices</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>Google Kubernetes Engine (GKE) is a managed Kubernetes service that provides a powerful platform for deploying, managing, and scaling containerized applications. This guide covers everything from basic cluster creation to advanced configurations.</p>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="gke-cluster-types">GKE Cluster Types<a href="#gke-cluster-types" class="hash-link" aria-label="Direct link to GKE Cluster Types" title="Direct link to GKE Cluster Types" translate="no">​</a></h3>
<ul>
<li><strong>Standard Cluster</strong>: Full control over cluster configuration and node management</li>
<li><strong>Autopilot Cluster</strong>: Fully managed, optimized for cost and operational efficiency</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="required-tools">Required Tools<a href="#required-tools" class="hash-link" aria-label="Direct link to Required Tools" title="Direct link to Required Tools" translate="no">​</a></h3>
<ol>
<li><strong>Google Cloud SDK (gcloud)</strong></li>
<li><strong>kubectl</strong> - Kubernetes command-line tool</li>
<li><strong>Docker</strong> (for building container images)</li>
<li><strong>Helm</strong> (optional, for package management)</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="installation-commands">Installation Commands<a href="#installation-commands" class="hash-link" aria-label="Direct link to Installation Commands" title="Direct link to Installation Commands" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Install Google Cloud SDK (macOS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl https://sdk.cloud.google.com | bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec -l $SHELL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud components install kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install Docker (macOS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install Helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl https://get.helm.sh/helm-v3.13.0-darwin-amd64.tar.gz | tar xz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv darwin-amd64/helm /usr/local/bin/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="gcp-account-setup">GCP Account Setup<a href="#gcp-account-setup" class="hash-link" aria-label="Direct link to GCP Account Setup" title="Direct link to GCP Account Setup" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Authenticate with Google Cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud auth login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List available projects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create a new project (if needed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects create PROJECT_ID --name=&quot;My GKE Project&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set the project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set project PROJECT_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable billing (required for GKE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This must be done through the GCP Console</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="initial-setup">Initial Setup<a href="#initial-setup" class="hash-link" aria-label="Direct link to Initial Setup" title="Direct link to Initial Setup" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="step-1-enable-required-apis">Step 1: Enable Required APIs<a href="#step-1-enable-required-apis" class="hash-link" aria-label="Direct link to Step 1: Enable Required APIs" title="Direct link to Step 1: Enable Required APIs" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Enable essential APIs for GKE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable container.googleapis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable compute.googleapis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable monitoring.googleapis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable logging.googleapis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable cloudresourcemanager.googleapis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable storage-api.googleapis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable artifactregistry.googleapis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify enabled APIs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services list --enabled</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="step-2-set-default-configuration">Step 2: Set Default Configuration<a href="#step-2-set-default-configuration" class="hash-link" aria-label="Direct link to Step 2: Set Default Configuration" title="Direct link to Step 2: Set Default Configuration" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Set default region and zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set compute/region us-central1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config set compute/zone us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config list</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="step-3-create-service-account-optional-but-recommended">Step 3: Create Service Account (Optional but Recommended)<a href="#step-3-create-service-account-optional-but-recommended" class="hash-link" aria-label="Direct link to Step 3: Create Service Account (Optional but Recommended)" title="Direct link to Step 3: Create Service Account (Optional but Recommended)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create service account for GKE operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts create gke-service-account \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --description=&quot;Service account for GKE cluster operations&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --display-name=&quot;GKE Service Account&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Grant necessary roles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects add-iam-policy-binding PROJECT_ID \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --member=&quot;serviceAccount:gke-service-account@PROJECT_ID.iam.gserviceaccount.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --role=&quot;roles/container.developer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects add-iam-policy-binding PROJECT_ID \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --member=&quot;serviceAccount:gke-service-account@PROJECT_ID.iam.gserviceaccount.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --role=&quot;roles/storage.objectViewer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Download service account key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts keys create ~/gke-service-account-key.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --iam-account=gke-service-account@PROJECT_ID.iam.gserviceaccount.com</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="terraform-setup">Terraform Setup<a href="#terraform-setup" class="hash-link" aria-label="Direct link to Terraform Setup" title="Direct link to Terraform Setup" translate="no">​</a></h2>
<p>Infrastructure as Code (IaC) with Terraform provides reproducible, version-controlled infrastructure deployments. This section covers comprehensive GKE cluster setup using Terraform.</p>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="prerequisites-for-terraform">Prerequisites for Terraform<a href="#prerequisites-for-terraform" class="hash-link" aria-label="Direct link to Prerequisites for Terraform" title="Direct link to Prerequisites for Terraform" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="install-terraform">Install Terraform<a href="#install-terraform" class="hash-link" aria-label="Direct link to Install Terraform" title="Direct link to Install Terraform" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Install Terraform (macOS)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install Terraform (Linux)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://releases.hashicorp.com/terraform/1.6.2/terraform_1.6.2_linux_amd64.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unzip terraform_1.6.2_linux_amd64.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv terraform /usr/local/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify installation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform version</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="setup-service-account-for-terraform">Setup Service Account for Terraform<a href="#setup-service-account-for-terraform" class="hash-link" aria-label="Direct link to Setup Service Account for Terraform" title="Direct link to Setup Service Account for Terraform" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create service account for Terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts create terraform-gke \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --description=&quot;Terraform service account for GKE&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --display-name=&quot;Terraform GKE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Grant necessary roles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects add-iam-policy-binding PROJECT_ID \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --member=&quot;serviceAccount:terraform-gke@PROJECT_ID.iam.gserviceaccount.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --role=&quot;roles/container.admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects add-iam-policy-binding PROJECT_ID \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --member=&quot;serviceAccount:terraform-gke@PROJECT_ID.iam.gserviceaccount.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --role=&quot;roles/compute.admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects add-iam-policy-binding PROJECT_ID \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --member=&quot;serviceAccount:terraform-gke@PROJECT_ID.iam.gserviceaccount.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --role=&quot;roles/iam.serviceAccountAdmin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects add-iam-policy-binding PROJECT_ID \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --member=&quot;serviceAccount:terraform-gke@PROJECT_ID.iam.gserviceaccount.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --role=&quot;roles/resourcemanager.projectIamAdmin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Download service account key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts keys create terraform-gke-key.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --iam-account=terraform-gke@PROJECT_ID.iam.gserviceaccount.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set environment variable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export GOOGLE_APPLICATION_CREDENTIALS=&quot;$(pwd)/terraform-gke-key.json&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="basic-terraform-configuration">Basic Terraform Configuration<a href="#basic-terraform-configuration" class="hash-link" aria-label="Direct link to Basic Terraform Configuration" title="Direct link to Basic Terraform Configuration" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="project-structure">Project Structure<a href="#project-structure" class="hash-link" aria-label="Direct link to Project Structure" title="Direct link to Project Structure" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create Terraform project structure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir gke-terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd gke-terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create directory structure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p {modules/gke,modules/vpc,environments/dev,environments/prod}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Project structure:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># gke-terraform/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ├── main.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ├── variables.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ├── outputs.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ├── terraform.tfvars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ├── versions.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ├── modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │   ├── gke/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># │   └── vpc/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># └── environments/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     ├── dev/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     └── prod/</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="provider-configuration">Provider Configuration<a href="#provider-configuration" class="hash-link" aria-label="Direct link to Provider Configuration" title="Direct link to Provider Configuration" translate="no">​</a></h4>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># versions.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required_version = &quot;&gt;= 1.6&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  required_providers {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    google = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;hashicorp/google&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;~&gt; 5.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    google-beta = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      source  = &quot;hashicorp/google-beta&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      version = &quot;~&gt; 5.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Optional: Configure remote state storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  backend &quot;gcs&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bucket = &quot;your-terraform-state-bucket&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prefix = &quot;gke-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;google&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project = var.project_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region  = var.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;google-beta&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project = var.project_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region  = var.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="variables-configuration">Variables Configuration<a href="#variables-configuration" class="hash-link" aria-label="Direct link to Variables Configuration" title="Direct link to Variables Configuration" translate="no">​</a></h4>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># variables.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;project_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The GCP project ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;region&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The GCP region&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;us-central1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;zones&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The GCP zones&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = list(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = [&quot;us-central1-a&quot;, &quot;us-central1-b&quot;, &quot;us-central1-c&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;cluster_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the GKE cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;gke-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;network_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the VPC network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;gke-network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;subnet_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;gke-subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;master_ipv4_cidr_block&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The IP range for the cluster master&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;172.16.0.0/28&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;cluster_secondary_range_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the secondary range for pods&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;gke-pods&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;services_secondary_range_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the secondary range for services&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;gke-services&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_private_nodes&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Whether to enable private nodes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_private_endpoint&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Whether to enable private endpoint&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;authorized_networks&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;List of authorized networks for API server access&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = list(object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_block   = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display_name = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cidr_block   = &quot;0.0.0.0/0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      display_name = &quot;All networks&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;node_pools&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;List of node pools&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = list(object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name         = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_type = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_size_gb = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_type    = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_type   = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_repair  = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_upgrade = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    preemptible  = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_count    = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_count    = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initial_node_count = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_labels  = map(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_taints = list(object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      key    = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value  = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      effect = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name         = &quot;primary-pool&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      machine_type = &quot;e2-medium&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      disk_size_gb = 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      disk_type    = &quot;pd-ssd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image_type   = &quot;COS_CONTAINERD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto_repair  = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto_upgrade = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      preemptible  = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      min_count    = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      max_count    = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      initial_node_count = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      node_labels  = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      node_taints  = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="vpc-network-module">VPC Network Module<a href="#vpc-network-module" class="hash-link" aria-label="Direct link to VPC Network Module" title="Direct link to VPC Network Module" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># modules/vpc/main.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_compute_network&quot; &quot;vpc&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                    = var.network_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto_create_subnetworks = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description             = &quot;VPC network for GKE cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_compute_subnetwork&quot; &quot;subnet&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name          = var.subnet_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ip_cidr_range = var.subnet_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region        = var.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network       = google_compute_network.vpc.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description   = &quot;Subnet for GKE cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  secondary_ip_range {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    range_name    = var.cluster_secondary_range_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ip_cidr_range = var.cluster_secondary_range_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  secondary_ip_range {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    range_name    = var.services_secondary_range_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ip_cidr_range = var.services_secondary_range_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private_ip_google_access = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aggregation_interval = &quot;INTERVAL_10_MIN&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flow_sampling        = 0.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata             = &quot;INCLUDE_ALL_METADATA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cloud Router for NAT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_compute_router&quot; &quot;router&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name    = &quot;${var.network_name}-router&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region  = var.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network = google_compute_network.vpc.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cloud NAT for private nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_compute_router_nat&quot; &quot;nat&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                               = &quot;${var.network_name}-nat&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  router                             = google_compute_router.router.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region                             = var.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nat_ip_allocate_option            = &quot;AUTO_ONLY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source_subnetwork_ip_ranges_to_nat = &quot;ALL_SUBNETWORKS_ALL_IP_RANGES&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filter = &quot;ERRORS_ONLY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Firewall rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_compute_firewall&quot; &quot;allow_internal&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name    = &quot;${var.network_name}-allow-internal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network = google_compute_network.vpc.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol = &quot;icmp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol = &quot;tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports    = [&quot;0-65535&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol = &quot;udp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports    = [&quot;0-65535&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source_ranges = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var.subnet_cidr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var.cluster_secondary_range_cidr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var.services_secondary_range_cidr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Allow internal communication within VPC&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_compute_firewall&quot; &quot;allow_ssh&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name    = &quot;${var.network_name}-allow-ssh&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network = google_compute_network.vpc.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol = &quot;tcp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ports    = [&quot;22&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source_ranges = [&quot;0.0.0.0/0&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target_tags   = [&quot;ssh-allowed&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description   = &quot;Allow SSH access&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># modules/vpc/variables.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;network_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Name of the VPC network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;subnet_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Name of the subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;subnet_cidr&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;CIDR range for the subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;10.1.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;cluster_secondary_range_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Name of the secondary range for pods&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;cluster_secondary_range_cidr&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;CIDR range for pods&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;10.2.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;services_secondary_range_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Name of the secondary range for services&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;services_secondary_range_cidr&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;CIDR range for services&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;10.3.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;region&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;GCP region&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># modules/vpc/outputs.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;network_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The ID of the VPC network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_compute_network.vpc.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;network_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the VPC network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_compute_network.vpc.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;subnet_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The ID of the subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_compute_subnetwork.subnet.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;subnet_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_compute_subnetwork.subnet.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="gke-cluster-module">GKE Cluster Module<a href="#gke-cluster-module" class="hash-link" aria-label="Direct link to GKE Cluster Module" title="Direct link to GKE Cluster Module" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># modules/gke/main.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_service_account&quot; &quot;gke_service_account&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  account_id   = &quot;${var.cluster_name}-sa&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  display_name = &quot;GKE Service Account for ${var.cluster_name}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description  = &quot;Service account for GKE cluster nodes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_project_iam_member&quot; &quot;gke_service_account_roles&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for_each = toset([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles/logging.logWriter&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles/monitoring.metricWriter&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles/monitoring.viewer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles/stackdriver.resourceMetadata.writer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;roles/storage.objectViewer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project = var.project_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role    = each.value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  member  = &quot;serviceAccount:${google_service_account.gke_service_account.email}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_container_cluster&quot; &quot;primary&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name     = var.cluster_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location = var.regional ? var.region : var.zone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Remove default node pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  remove_default_node_pool = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  initial_node_count       = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Network configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network    = var.network_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnetwork = var.subnet_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # IP allocation policy for VPC-native networking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ip_allocation_policy {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster_secondary_range_name  = var.cluster_secondary_range_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services_secondary_range_name = var.services_secondary_range_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Private cluster configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dynamic &quot;private_cluster_config&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for_each = var.enable_private_nodes ? [1] : []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enable_private_nodes    = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enable_private_endpoint = var.enable_private_endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      master_ipv4_cidr_block  = var.master_ipv4_cidr_block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Master authorized networks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dynamic &quot;master_authorized_networks_config&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for_each = length(var.authorized_networks) &gt; 0 ? [1] : []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dynamic &quot;cidr_blocks&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for_each = var.authorized_networks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cidr_block   = cidr_blocks.value.cidr_block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          display_name = cidr_blocks.value.display_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Workload Identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workload_identity_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workload_pool = &quot;${var.project_id}.svc.id.goog&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Add-ons configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  addons_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http_load_balancing {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      disabled = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    horizontal_pod_autoscaling {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      disabled = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_policy_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      disabled = !var.enable_network_policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dns_cache_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enabled = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gcp_filestore_csi_driver_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enabled = var.enable_filestore_csi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Network policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dynamic &quot;network_policy&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for_each = var.enable_network_policy ? [1] : []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enabled  = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      provider = &quot;CALICO&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Cluster security</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_shielded_nodes = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Binary authorization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_binary_authorization = var.enable_binary_authorization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Database encryption</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dynamic &quot;database_encryption&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for_each = var.database_encryption_key != &quot;&quot; ? [1] : []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      state    = &quot;ENCRYPTED&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      key_name = var.database_encryption_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Maintenance policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  maintenance_policy {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    daily_maintenance_window {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      start_time = var.maintenance_start_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Resource usage export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resource_usage_export_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_network_egress_metering = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_resource_consumption_metering = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bigquery_destination {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      dataset_id = var.resource_usage_bigquery_dataset_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Logging and monitoring configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logging_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_components = var.logging_components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  monitoring_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_components = var.monitoring_components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Lifecycle rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lifecycle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ignore_changes = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Ignore changes to initial_node_count as we manage nodes via node pools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      initial_node_count,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Node pools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_container_node_pool&quot; &quot;node_pools&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for_each = { for np in var.node_pools : np.name =&gt; np }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name       = each.value.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location   = google_container_cluster.primary.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster    = google_container_cluster.primary.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  initial_node_count = each.value.initial_node_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Autoscaling configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  autoscaling {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_node_count = each.value.min_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_node_count = each.value.max_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Management configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  management {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_repair  = each.value.auto_repair</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_upgrade = each.value.auto_upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Node configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    preemptible  = each.value.preemptible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_type = each.value.machine_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_size_gb = each.value.disk_size_gb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_type    = each.value.disk_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_type   = each.value.image_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Service account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service_account = google_service_account.gke_service_account.email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    oauth_scopes = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;https://www.googleapis.com/auth/cloud-platform&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    labels = merge(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      each.value.node_labels,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cluster = var.cluster_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pool    = each.value.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Taints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dynamic &quot;taint&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      for_each = each.value.node_taints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      content {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        key    = taint.value.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value  = taint.value.value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        effect = taint.value.effect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Shielded instance configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shielded_instance_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enable_secure_boot          = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      enable_integrity_monitoring = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Workload metadata configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    workload_metadata_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mode = &quot;GKE_METADATA&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      disable-legacy-endpoints = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Upgrade settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  upgrade_settings {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_surge       = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_unavailable = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Lifecycle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lifecycle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ignore_changes = [initial_node_count]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># modules/gke/variables.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;project_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The GCP project ID&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;cluster_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the GKE cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;region&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The GCP region&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;zone&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The GCP zone (for zonal clusters)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;regional&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Whether to create a regional cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;network_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The ID of the VPC network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;subnet_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The ID of the subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;cluster_secondary_range_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the secondary range for pods&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;services_secondary_range_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the secondary range for services&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_private_nodes&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Whether to enable private nodes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_private_endpoint&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Whether to enable private endpoint&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;master_ipv4_cidr_block&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The IP range for the cluster master&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;172.16.0.0/28&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;authorized_networks&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;List of authorized networks&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = list(object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_block   = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display_name = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_network_policy&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Whether to enable network policy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_filestore_csi&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Whether to enable Filestore CSI driver&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;enable_binary_authorization&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Whether to enable binary authorization&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;database_encryption_key&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The Cloud KMS key to use for database encryption&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;maintenance_start_time&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Start time for daily maintenance window&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;03:00&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;resource_usage_bigquery_dataset_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;BigQuery dataset ID for resource usage export&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;logging_components&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;List of logging components to enable&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = list(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = [&quot;SYSTEM_COMPONENTS&quot;, &quot;WORKLOADS&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;monitoring_components&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;List of monitoring components to enable&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type        = list(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default     = [&quot;SYSTEM_COMPONENTS&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variable &quot;node_pools&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;List of node pool configurations&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = list(object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name         = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_type = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_size_gb = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_type    = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_type   = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_repair  = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_upgrade = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    preemptible  = bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_count    = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_count    = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initial_node_count = number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_labels  = map(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_taints = list(object({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      key    = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value  = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      effect = string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># modules/gke/outputs.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cluster_id&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The ID of the cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_container_cluster.primary.id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cluster_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_container_cluster.primary.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cluster_location&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The location of the cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_container_cluster.primary.location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cluster_endpoint&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The cluster endpoint&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_container_cluster.primary.endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensitive   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cluster_ca_certificate&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The cluster CA certificate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_container_cluster.primary.master_auth[0].cluster_ca_certificate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensitive   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;service_account_email&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The service account email&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_service_account.gke_service_account.email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;node_pools&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The node pools&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = google_container_node_pool.node_pools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="main-terraform-configuration">Main Terraform Configuration<a href="#main-terraform-configuration" class="hash-link" aria-label="Direct link to Main Terraform Configuration" title="Direct link to Main Terraform Configuration" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># main.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable required APIs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource &quot;google_project_service&quot; &quot;required_apis&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for_each = toset([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;compute.googleapis.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;container.googleapis.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;monitoring.googleapis.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;logging.googleapis.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;cloudresourcemanager.googleapis.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;certificatemanager.googleapis.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project = var.project_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service = each.value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  disable_dependent_services = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  disable_on_destroy         = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># VPC Network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;vpc&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source = &quot;./modules/vpc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_name                      = var.network_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_name                       = var.subnet_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_secondary_range_name      = var.cluster_secondary_range_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  services_secondary_range_name     = var.services_secondary_range_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region                           = var.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on = [google_project_service.required_apis]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GKE Cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;gke&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source = &quot;./modules/gke&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  project_id                        = var.project_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_name                      = var.cluster_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  region                           = var.region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  network_id                       = module.vpc.network_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  subnet_id                        = module.vpc.subnet_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_secondary_range_name      = var.cluster_secondary_range_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  services_secondary_range_name     = var.services_secondary_range_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_private_nodes             = var.enable_private_nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enable_private_endpoint          = var.enable_private_endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  master_ipv4_cidr_block           = var.master_ipv4_cidr_block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  authorized_networks              = var.authorized_networks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  node_pools                       = var.node_pools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  depends_on = [module.vpc]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="terraform-variables-file">Terraform Variables File<a href="#terraform-variables-file" class="hash-link" aria-label="Direct link to Terraform Variables File" title="Direct link to Terraform Variables File" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># terraform.tfvars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project_id   = &quot;your-gcp-project-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">region       = &quot;us-central1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster_name = &quot;production-gke-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Network configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network_name = &quot;gke-vpc&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subnet_name  = &quot;gke-subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Private cluster settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_private_nodes    = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_private_endpoint = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master_ipv4_cidr_block = &quot;172.16.0.0/28&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Authorized networks for API server access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">authorized_networks = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_block   = &quot;10.0.0.0/8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display_name = &quot;Internal networks&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cidr_block   = &quot;YOUR_OFFICE_IP/32&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display_name = &quot;Office network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Node pools configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node_pools = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name               = &quot;primary-pool&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_type       = &quot;e2-standard-4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_size_gb       = 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_type          = &quot;pd-ssd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_type         = &quot;COS_CONTAINERD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_repair        = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_upgrade       = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    preemptible        = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_count          = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_count          = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initial_node_count = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_labels = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      environment = &quot;production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      workload    = &quot;general&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_taints = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name               = &quot;spot-pool&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_type       = &quot;e2-standard-2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_size_gb       = 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_type          = &quot;pd-standard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_type         = &quot;COS_CONTAINERD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_repair        = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_upgrade       = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    preemptible        = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_count          = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_count          = 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initial_node_count = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_labels = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      environment = &quot;production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      workload    = &quot;spot&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_taints = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        key    = &quot;spot&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value  = &quot;true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        effect = &quot;NO_SCHEDULE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="outputs-configuration">Outputs Configuration<a href="#outputs-configuration" class="hash-link" aria-label="Direct link to Outputs Configuration" title="Direct link to Outputs Configuration" translate="no">​</a></h3>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># outputs.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cluster_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the GKE cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.gke.cluster_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cluster_location&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The location of the GKE cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.gke.cluster_location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;cluster_endpoint&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The endpoint of the GKE cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.gke.cluster_endpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensitive   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;network_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the VPC network&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.vpc.network_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;subnet_name&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The name of the subnet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.vpc.subnet_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;service_account_email&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;The email of the GKE service account&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = module.gke.service_account_email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output &quot;kubectl_connection_command&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description = &quot;Command to connect kubectl to the cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value       = &quot;gcloud container clusters get-credentials ${module.gke.cluster_name} --region ${module.gke.cluster_location} --project ${var.project_id}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="deployment-instructions">Deployment Instructions<a href="#deployment-instructions" class="hash-link" aria-label="Direct link to Deployment Instructions" title="Direct link to Deployment Instructions" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="1-initialize-and-plan">1. Initialize and Plan<a href="#1-initialize-and-plan" class="hash-link" aria-label="Direct link to 1. Initialize and Plan" title="Direct link to 1. Initialize and Plan" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Initialize Terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Validate configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform validate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Plan deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan -var-file=&quot;terraform.tfvars&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Review the plan carefully before applying</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="2-deploy-infrastructure">2. Deploy Infrastructure<a href="#2-deploy-infrastructure" class="hash-link" aria-label="Direct link to 2. Deploy Infrastructure" title="Direct link to 2. Deploy Infrastructure" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Apply the configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply -var-file=&quot;terraform.tfvars&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Confirm with &#x27;yes&#x27; when prompted</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="3-connect-to-cluster">3. Connect to Cluster<a href="#3-connect-to-cluster" class="hash-link" aria-label="Direct link to 3. Connect to Cluster" title="Direct link to 3. Connect to Cluster" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Get cluster credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters get-credentials production-gke-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region us-central1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --project your-gcp-project-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cluster-info</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="4-verify-deployment">4. Verify Deployment<a href="#4-verify-deployment" class="hash-link" aria-label="Direct link to 4. Verify Deployment" title="Direct link to 4. Verify Deployment" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Check cluster status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check node pools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes --show-labels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify networking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get services -A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -A</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="environment-specific-configurations">Environment-Specific Configurations<a href="#environment-specific-configurations" class="hash-link" aria-label="Direct link to Environment-Specific Configurations" title="Direct link to Environment-Specific Configurations" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="development-environment">Development Environment<a href="#development-environment" class="hash-link" aria-label="Direct link to Development Environment" title="Direct link to Development Environment" translate="no">​</a></h4>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># environments/dev/terraform.tfvars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project_id   = &quot;your-dev-project-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster_name = &quot;dev-gke-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_private_nodes    = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_private_endpoint = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node_pools = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name               = &quot;dev-pool&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_type       = &quot;e2-medium&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_size_gb       = 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_type          = &quot;pd-standard&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_type         = &quot;COS_CONTAINERD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_repair        = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_upgrade       = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    preemptible        = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_count          = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_count          = 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initial_node_count = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_labels = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      environment = &quot;development&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_taints = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="production-environment">Production Environment<a href="#production-environment" class="hash-link" aria-label="Direct link to Production Environment" title="Direct link to Production Environment" translate="no">​</a></h4>
<div class="language-hcl codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-hcl codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># environments/prod/terraform.tfvars</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project_id   = &quot;your-prod-project-id&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster_name = &quot;prod-gke-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_private_nodes          = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_private_endpoint       = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_binary_authorization   = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">database_encryption_key       = &quot;projects/your-project/locations/us-central1/keyRings/gke-ring/cryptoKeys/gke-key&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">node_pools = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name               = &quot;production-pool&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    machine_type       = &quot;e2-standard-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_size_gb       = 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disk_type          = &quot;pd-ssd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_type         = &quot;COS_CONTAINERD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_repair        = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto_upgrade       = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    preemptible        = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_count          = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_count          = 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initial_node_count = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_labels = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      environment = &quot;production&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tier        = &quot;primary&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    node_taints = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="terraform-best-practices">Terraform Best Practices<a href="#terraform-best-practices" class="hash-link" aria-label="Direct link to Terraform Best Practices" title="Direct link to Terraform Best Practices" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="1-state-management">1. State Management<a href="#1-state-management" class="hash-link" aria-label="Direct link to 1. State Management" title="Direct link to 1. State Management" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create bucket for remote state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil mb gs://your-terraform-state-bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable versioning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gsutil versioning set on gs://your-terraform-state-bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configure state locking with Cloud Storage</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="2-workspace-management">2. Workspace Management<a href="#2-workspace-management" class="hash-link" aria-label="Direct link to 2. Workspace Management" title="Direct link to 2. Workspace Management" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create workspaces for different environments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform workspace new dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform workspace new staging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform workspace new prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Switch between workspaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform workspace select prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform workspace list</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="3-security-considerations">3. Security Considerations<a href="#3-security-considerations" class="hash-link" aria-label="Direct link to 3. Security Considerations" title="Direct link to 3. Security Considerations" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Encrypt terraform state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use Google Secret Manager for sensitive variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Implement least privilege IAM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable audit logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Use private clusters for production</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="4-automation-with-cicd">4. Automation with CI/CD<a href="#4-automation-with-cicd" class="hash-link" aria-label="Direct link to 4. Automation with CI/CD" title="Direct link to 4. Automation with CI/CD" translate="no">​</a></h4>
<div class="language-yaml codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-yaml codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># .github/workflows/terraform.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Terraform GKE Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pull_request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">terraform</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup Terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hashicorp/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">terraform@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">terraform_version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.6.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Setup Google Cloud Auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> google</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">github</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">actions/auth@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">credentials_json</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.GCP_SA_KEY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Terraform Init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> terraform init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Terraform Plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> terraform plan </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">var</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file=&quot;environments/prod/terraform.tfvars&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Terraform Apply</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github.ref == &#x27;refs/heads/main&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> terraform apply </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">auto</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">approve </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">var</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file=&quot;environments/prod/terraform.tfvars&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="cleanup">Cleanup<a href="#cleanup" class="hash-link" aria-label="Direct link to Cleanup" title="Direct link to Cleanup" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Destroy infrastructure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy -var-file=&quot;terraform.tfvars&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Confirm with &#x27;yes&#x27; when prompted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Clean up local files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf .terraform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm terraform.tfstate*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm terraform-gke-key.json</span><br></span></code></pre></div></div>
<p>This Terraform setup provides a production-ready, scalable, and secure GKE cluster configuration with proper networking, security, and monitoring capabilities.</p>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="cluster-creation-options">Cluster Creation Options<a href="#cluster-creation-options" class="hash-link" aria-label="Direct link to Cluster Creation Options" title="Direct link to Cluster Creation Options" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="comparison-standard-vs-autopilot">Comparison: Standard vs Autopilot<a href="#comparison-standard-vs-autopilot" class="hash-link" aria-label="Direct link to Comparison: Standard vs Autopilot" title="Direct link to Comparison: Standard vs Autopilot" translate="no">​</a></h3>
<table><thead><tr><th>Feature</th><th>Standard GKE</th><th>Autopilot GKE</th></tr></thead><tbody><tr><td><strong>Node Management</strong></td><td>Manual</td><td>Fully managed</td></tr><tr><td><strong>Scaling</strong></td><td>Manual/Auto</td><td>Automatic</td></tr><tr><td><strong>Security</strong></td><td>User configured</td><td>Pre-hardened</td></tr><tr><td><strong>Cost Model</strong></td><td>Pay for nodes</td><td>Pay for pods</td></tr><tr><td><strong>Customization</strong></td><td>Full control</td><td>Limited</td></tr><tr><td><strong>Maintenance</strong></td><td>User managed</td><td>Google managed</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="when-to-choose-standard-gke">When to Choose Standard GKE<a href="#when-to-choose-standard-gke" class="hash-link" aria-label="Direct link to When to Choose Standard GKE" title="Direct link to When to Choose Standard GKE" translate="no">​</a></h3>
<ul>
<li>Need custom node configurations</li>
<li>Require specific machine types</li>
<li>Need privileged containers</li>
<li>Require custom networking</li>
<li>Need GPU/TPU workloads</li>
<li>Require Windows nodes</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="when-to-choose-autopilot-gke">When to Choose Autopilot GKE<a href="#when-to-choose-autopilot-gke" class="hash-link" aria-label="Direct link to When to Choose Autopilot GKE" title="Direct link to When to Choose Autopilot GKE" translate="no">​</a></h3>
<ul>
<li>Want minimal operational overhead</li>
<li>Cost optimization is priority</li>
<li>Standard security requirements</li>
<li>Stateless applications</li>
<li>Development/testing environments</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="standard-gke-cluster-setup">Standard GKE Cluster Setup<a href="#standard-gke-cluster-setup" class="hash-link" aria-label="Direct link to Standard GKE Cluster Setup" title="Direct link to Standard GKE Cluster Setup" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="basic-standard-cluster">Basic Standard Cluster<a href="#basic-standard-cluster" class="hash-link" aria-label="Direct link to Basic Standard Cluster" title="Direct link to Basic Standard Cluster" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create a basic standard GKE cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create my-gke-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type=e2-medium \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-size=20GB \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-type=pd-standard \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoscaling \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --min-nodes=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --max-nodes=10 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autorepair \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoupgrade</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="production-ready-standard-cluster">Production-Ready Standard Cluster<a href="#production-ready-standard-cluster" class="hash-link" aria-label="Direct link to Production-Ready Standard Cluster" title="Direct link to Production-Ready Standard Cluster" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create production-ready standard cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-locations=us-central1-a,us-central1-b,us-central1-c \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type=e2-standard-4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-size=50GB \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-type=pd-ssd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image-type=COS_CONTAINERD \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-network-policy \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-ip-alias \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-subnetwork=&quot;&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-secondary-range-name=pods \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --services-secondary-range-name=services \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoscaling \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --min-nodes=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --max-nodes=20 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autorepair \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoupgrade \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --maintenance-window-start=2023-01-01T09:00:00Z \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --maintenance-window-end=2023-01-01T17:00:00Z \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --maintenance-window-recurrence=&quot;FREQ=WEEKLY;BYDAY=SA&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-shielded-nodes \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-cloud-logging \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-cloud-monitoring \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --logging=SYSTEM,WORKLOAD \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --monitoring=SYSTEM \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --workload-pool=PROJECT_ID.svc.id.goog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --addons=HorizontalPodAutoscaling,HttpLoadBalancing,NodeLocalDNS</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="advanced-standard-cluster-configuration">Advanced Standard Cluster Configuration<a href="#advanced-standard-cluster-configuration" class="hash-link" aria-label="Direct link to Advanced Standard Cluster Configuration" title="Direct link to Advanced Standard Cluster Configuration" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create advanced cluster with custom networking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create advanced-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-locations=us-central1-a,us-central1-b,us-central1-c \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type=e2-standard-4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-size=100GB \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-type=pd-ssd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image-type=COS_CONTAINERD \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --network=my-vpc-network \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --subnetwork=my-gke-subnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-secondary-range-name=gke-pods \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --services-secondary-range-name=gke-services \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-ip-alias \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-network-policy \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-private-nodes \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --master-ipv4-cidr=172.16.0.0/28 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoscaling \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --min-nodes=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --max-nodes=50 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autorepair \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoupgrade \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-shielded-nodes \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --shielded-secure-boot \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --shielded-integrity-monitoring \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --workload-pool=PROJECT_ID.svc.id.goog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-cloud-logging \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-cloud-monitoring \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --logging=SYSTEM,WORKLOAD,API_SERVER \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --monitoring=SYSTEM,WORKLOAD \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --release-channel=stable \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --addons=HorizontalPodAutoscaling,HttpLoadBalancing,NodeLocalDNS,GcpFilestoreCsiDriver</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="autopilot-gke-cluster-setup">Autopilot GKE Cluster Setup<a href="#autopilot-gke-cluster-setup" class="hash-link" aria-label="Direct link to Autopilot GKE Cluster Setup" title="Direct link to Autopilot GKE Cluster Setup" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="basic-autopilot-cluster">Basic Autopilot Cluster<a href="#basic-autopilot-cluster" class="hash-link" aria-label="Direct link to Basic Autopilot Cluster" title="Direct link to Basic Autopilot Cluster" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create basic Autopilot cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create-auto my-autopilot-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region=us-central1</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="production-autopilot-cluster">Production Autopilot Cluster<a href="#production-autopilot-cluster" class="hash-link" aria-label="Direct link to Production Autopilot Cluster" title="Direct link to Production Autopilot Cluster" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create production Autopilot cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create-auto production-autopilot \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region=us-central1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --network=my-vpc-network \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --subnetwork=my-autopilot-subnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-secondary-range-name=autopilot-pods \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --services-secondary-range-name=autopilot-services \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-private-nodes \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --master-ipv4-cidr=172.16.0.0/28 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --workload-pool=PROJECT_ID.svc.id.goog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --logging=SYSTEM,WORKLOAD \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --monitoring=SYSTEM</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="node-pool-configuration">Node Pool Configuration<a href="#node-pool-configuration" class="hash-link" aria-label="Direct link to Node Pool Configuration" title="Direct link to Node Pool Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="create-additional-node-pools">Create Additional Node Pools<a href="#create-additional-node-pools" class="hash-link" aria-label="Direct link to Create Additional Node Pools" title="Direct link to Create Additional Node Pools" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create CPU-optimized node pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create cpu-optimized-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster=production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type=c2-standard-8 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoscaling \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --min-nodes=0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --max-nodes=10 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-size=50GB \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-type=pd-ssd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-taints=workload-type=cpu-intensive:NoSchedule \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-labels=workload-type=cpu-intensive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create memory-optimized node pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create memory-optimized-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster=production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type=n2-highmem-4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoscaling \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --min-nodes=0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --max-nodes=5 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-size=100GB \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-type=pd-ssd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-taints=workload-type=memory-intensive:NoSchedule \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-labels=workload-type=memory-intensive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create GPU node pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create gpu-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster=production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type=n1-standard-4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --accelerator=type=nvidia-tesla-t4,count=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoscaling \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --min-nodes=0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --max-nodes=3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-size=100GB \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --disk-type=pd-ssd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-taints=nvidia.com/gpu=present:NoSchedule \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-labels=accelerator=nvidia-tesla-t4</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="node-pool-management">Node Pool Management<a href="#node-pool-management" class="hash-link" aria-label="Direct link to Node Pool Management" title="Direct link to Node Pool Management" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># List node pools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools list --cluster=production-cluster --zone=us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Resize node pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters resize production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-pool=default-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=5 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Update node pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools update default-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster=production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoupgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Delete node pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools delete old-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster=production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="security-configuration">Security Configuration<a href="#security-configuration" class="hash-link" aria-label="Direct link to Security Configuration" title="Direct link to Security Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="workload-identity-setup">Workload Identity Setup<a href="#workload-identity-setup" class="hash-link" aria-label="Direct link to Workload Identity Setup" title="Direct link to Workload Identity Setup" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Enable Workload Identity on existing cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters update production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --workload-pool=PROJECT_ID.svc.id.goog \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Update node pool for Workload Identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools update default-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster=production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --workload-metadata=GKE_METADATA \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create Kubernetes service account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create serviceaccount my-ksa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create Google service account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts create my-gsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Bind accounts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud iam service-accounts add-iam-policy-binding \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    my-gsa@PROJECT_ID.iam.gserviceaccount.com \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --role roles/iam.workloadIdentityUser \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --member &quot;serviceAccount:PROJECT_ID.svc.id.goog[default/my-ksa]&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Annotate Kubernetes service account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl annotate serviceaccount my-ksa \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iam.gke.io/gcp-service-account=my-gsa@PROJECT_ID.iam.gserviceaccount.com</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="network-security">Network Security<a href="#network-security" class="hash-link" aria-label="Direct link to Network Security" title="Direct link to Network Security" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create VPC network for GKE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute networks create gke-vpc --subnet-mode=custom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create subnet for GKE cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute networks subnets create gke-subnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --network=gke-vpc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --range=10.1.0.0/16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --secondary-range=gke-pods=10.2.0.0/16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --secondary-range=gke-services=10.3.0.0/16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region=us-central1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create firewall rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute firewall-rules create allow-gke-internal \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --network=gke-vpc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --allow=tcp,udp,icmp \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --source-ranges=10.1.0.0/16,10.2.0.0/16,10.3.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable Private Google Access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute networks subnets update gke-subnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --region=us-central1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-private-ip-google-access</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="pod-security-standards">Pod Security Standards<a href="#pod-security-standards" class="hash-link" aria-label="Direct link to Pod Security Standards" title="Direct link to Pod Security Standards" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-yaml codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># pod-security-policy.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> policy/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PodSecurityPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> restricted</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">psp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">privileged</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">allowPrivilegeEscalation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requiredDropCapabilities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ALL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;configMap&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;emptyDir&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;projected&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;secret&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;downwardAPI&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;persistentVolumeClaim&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">runAsUser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;MustRunAsNonRoot&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">seLinux</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;RunAsAny&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fsGroup</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;RunAsAny&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">readOnlyRootFilesystem</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="networking-configuration">Networking Configuration<a href="#networking-configuration" class="hash-link" aria-label="Direct link to Networking Configuration" title="Direct link to Networking Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="vpc-native-networking">VPC-Native Networking<a href="#vpc-native-networking" class="hash-link" aria-label="Direct link to VPC-Native Networking" title="Direct link to VPC-Native Networking" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create cluster with VPC-native networking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create vpc-native-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-ip-alias \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --network=gke-vpc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --subnetwork=gke-subnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-secondary-range-name=gke-pods \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --services-secondary-range-name=gke-services \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-network-policy</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="private-cluster-configuration">Private Cluster Configuration<a href="#private-cluster-configuration" class="hash-link" aria-label="Direct link to Private Cluster Configuration" title="Direct link to Private Cluster Configuration" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create private cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create private-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-private-nodes \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --master-ipv4-cidr=172.16.0.0/28 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-ip-alias \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --network=gke-vpc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --subnetwork=gke-subnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-secondary-range-name=gke-pods \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --services-secondary-range-name=gke-services \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-master-authorized-networks \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --master-authorized-networks=203.0.113.0/24</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="network-policies">Network Policies<a href="#network-policies" class="hash-link" aria-label="Direct link to Network Policies" title="Direct link to Network Policies" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-yaml codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># network-policy-deny-all.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NetworkPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deny</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">podSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">policyTypes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Egress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># network-policy-allow-frontend.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NetworkPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> allow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">podSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">policyTypes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">from</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">podSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> loadbalancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="monitoring-and-logging">Monitoring and Logging<a href="#monitoring-and-logging" class="hash-link" aria-label="Direct link to Monitoring and Logging" title="Direct link to Monitoring and Logging" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="enable-monitoring-and-logging">Enable Monitoring and Logging<a href="#enable-monitoring-and-logging" class="hash-link" aria-label="Direct link to Enable Monitoring and Logging" title="Direct link to Enable Monitoring and Logging" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Enable monitoring and logging on existing cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters update production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-cloud-logging \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-cloud-monitoring \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --logging=SYSTEM,WORKLOAD,API_SERVER \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --monitoring=SYSTEM,WORKLOAD \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="configure-custom-monitoring">Configure Custom Monitoring<a href="#configure-custom-monitoring" class="hash-link" aria-label="Direct link to Configure Custom Monitoring" title="Direct link to Configure Custom Monitoring" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-yaml codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># monitoring-config.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cluster</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">monitoring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">config.yaml</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    prometheusConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      retention: &quot;15d&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        limits:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          memory: &quot;4Gi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          memory: &quot;2Gi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    grafanaConfig:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      enabled: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      adminPassword: &quot;secure-password&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="log-aggregation-setup">Log Aggregation Setup<a href="#log-aggregation-setup" class="hash-link" aria-label="Direct link to Log Aggregation Setup" title="Direct link to Log Aggregation Setup" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create log sink for custom analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud logging sinks create gke-cluster-logs \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bigquery.googleapis.com/projects/PROJECT_ID/datasets/gke_logs \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log-filter=&#x27;resource.type=&quot;k8s_cluster&quot;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create log-based metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud logging metrics create pod_restart_count \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --description=&quot;Count of pod restarts&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log-filter=&#x27;resource.type=&quot;k8s_container&quot; AND protoPayload.methodName=&quot;io.k8s.core.v1.Event&quot;&#x27;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="storage-configuration">Storage Configuration<a href="#storage-configuration" class="hash-link" aria-label="Direct link to Storage Configuration" title="Direct link to Storage Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="persistent-volume-classes">Persistent Volume Classes<a href="#persistent-volume-classes" class="hash-link" aria-label="Direct link to Persistent Volume Classes" title="Direct link to Persistent Volume Classes" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-yaml codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># storage-classes.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fast</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes.io/gce</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ssd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">zones</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">central1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">central1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">central1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">allowVolumeExpansion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumeBindingMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> WaitForFirstConsumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slow</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hdd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes.io/gce</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">zones</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">central1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">central1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">central1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">allowVolumeExpansion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumeBindingMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> WaitForFirstConsumer</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="filestore-csi-driver">Filestore CSI Driver<a href="#filestore-csi-driver" class="hash-link" aria-label="Direct link to Filestore CSI Driver" title="Direct link to Filestore CSI Driver" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Enable Filestore CSI driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters update production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --update-addons=GcpFilestoreCsiDriver=ENABLED \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-yaml codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># filestore-pv.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> filestore</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">capacity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Ti</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">persistentVolumeReclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">csi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> filestore.csi.storage.gke.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeHandle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;projects/PROJECT_ID/locations/us-central1/instances/my-filestore/shares/my-share&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeAttributes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.0.0.2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volume</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;my-share&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="cluster-management">Cluster Management<a href="#cluster-management" class="hash-link" aria-label="Direct link to Cluster Management" title="Direct link to Cluster Management" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="connect-to-cluster">Connect to Cluster<a href="#connect-to-cluster" class="hash-link" aria-label="Direct link to Connect to Cluster" title="Direct link to Connect to Cluster" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Get cluster credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters get-credentials production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --project=PROJECT_ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify connection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cluster-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="cluster-upgrade">Cluster Upgrade<a href="#cluster-upgrade" class="hash-link" aria-label="Direct link to Cluster Upgrade" title="Direct link to Cluster Upgrade" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Check available versions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container get-server-config --zone=us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Upgrade master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters upgrade production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --master \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-version=1.28.3-gke.1203001 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Upgrade node pools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters upgrade production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-pool=default-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster-version=1.28.3-gke.1203001 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="backup-and-disaster-recovery">Backup and Disaster Recovery<a href="#backup-and-disaster-recovery" class="hash-link" aria-label="Direct link to Backup and Disaster Recovery" title="Direct link to Backup and Disaster Recovery" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Enable backup for applications</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container backup-restore backup-plans create my-backup-plan \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --project=PROJECT_ID \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --location=us-central1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster=projects/PROJECT_ID/locations/us-central1-a/clusters/production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --backup-schedule-cron-schedule=&quot;0 2 * * *&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --backup-retain-days=30</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="resource-quotas">Resource Quotas<a href="#resource-quotas" class="hash-link" aria-label="Direct link to Resource Quotas" title="Direct link to Resource Quotas" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-yaml codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># resource-quota.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ResourceQuota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">quota</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hard</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests.cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests.memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 200Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">limits.cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;200&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">limits.memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 400Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">persistentvolumeclaims</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pods</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;50&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="1-security-best-practices">1. Security Best Practices<a href="#1-security-best-practices" class="hash-link" aria-label="Direct link to 1. Security Best Practices" title="Direct link to 1. Security Best Practices" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Use least privilege access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud projects add-iam-policy-binding PROJECT_ID \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --member=&quot;user:developer@company.com&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --role=&quot;roles/container.developer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable audit logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud logging sinks create audit-logs \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage.googleapis.com/audit-logs-bucket \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log-filter=&#x27;protoPayload.serviceName=&quot;container.googleapis.com&quot;&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="2-resource-management">2. Resource Management<a href="#2-resource-management" class="hash-link" aria-label="Direct link to 2. Resource Management" title="Direct link to 2. Resource Management" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-yaml codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># resource-limits.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LimitRange</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> resource</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">limits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> production</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;500m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;512Mi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">defaultRequest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;128Mi&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Container</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="3-cost-optimization">3. Cost Optimization<a href="#3-cost-optimization" class="hash-link" aria-label="Direct link to 3. Cost Optimization" title="Direct link to 3. Cost Optimization" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Use preemptible nodes for non-critical workloads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create preemptible-pool \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --cluster=production-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type=e2-medium \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --preemptible \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoscaling \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --min-nodes=0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --max-nodes=10</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="4-high-availability">4. High Availability<a href="#4-high-availability" class="hash-link" aria-label="Direct link to 4. High Availability" title="Direct link to 4. High Availability" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Create multi-zone cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create ha-cluster \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone=us-central1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-locations=us-central1-a,us-central1-b,us-central1-c \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --num-nodes=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autorepair \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --enable-autoupgrade</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="common-issues">Common Issues<a href="#common-issues" class="hash-link" aria-label="Direct link to Common Issues" title="Direct link to Common Issues" translate="no">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="1-node-not-ready">1. Node Not Ready<a href="#1-node-not-ready" class="hash-link" aria-label="Direct link to 1. Node Not Ready" title="Direct link to 1. Node Not Ready" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Check node status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Describe node for events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe node NODE_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check node logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute ssh NODE_NAME --zone=us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo journalctl -u kubelet</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="2-pod-scheduling-issues">2. Pod Scheduling Issues<a href="#2-pod-scheduling-issues" class="hash-link" aria-label="Direct link to 2. Pod Scheduling Issues" title="Direct link to 2. Pod Scheduling Issues" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Check pod status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pod POD_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check resource availability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check taints and tolerations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes -o custom-columns=NAME:.metadata.name,TAINTS:.spec.taints</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="3-network-connectivity-issues">3. Network Connectivity Issues<a href="#3-network-connectivity-issues" class="hash-link" aria-label="Direct link to 3. Network Connectivity Issues" title="Direct link to 3. Network Connectivity Issues" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Test cluster DNS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl run test-dns --image=busybox --rm -it -- nslookup kubernetes.default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check network policies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get networkpolicies -A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Test pod-to-pod connectivity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl run test-pod --image=busybox --rm -it -- wget -qO- http://service-name.namespace.svc.cluster.local</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_vU8F" id="4-authentication-issues">4. Authentication Issues<a href="#4-authentication-issues" class="hash-link" aria-label="Direct link to 4. Authentication Issues" title="Direct link to 4. Authentication Issues" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Check current context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config current-context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># List contexts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config get-contexts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Switch context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context CONTEXT_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check cluster authentication</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters get-credentials CLUSTER_NAME --zone=ZONE</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="monitoring-commands">Monitoring Commands<a href="#monitoring-commands" class="hash-link" aria-label="Direct link to Monitoring Commands" title="Direct link to Monitoring Commands" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_SHfy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_PqAM"><pre tabindex="0" class="prism-code language-bash codeBlock_mdjV thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_rTdR"><span class="token-line" style="color:#393A34"><span class="token plain"># Cluster health</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get componentstatuses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Resource usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top pods -A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get events --sort-by=.metadata.creationTimestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -f deployment/my-app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud logging read &quot;resource.type=k8s_cluster&quot; --limit=50</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_vU8F" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<p>This comprehensive guide covers the essential aspects of setting up and managing GKE clusters. From basic cluster creation to advanced security and networking configurations, following these practices will help you build robust, scalable, and secure Kubernetes environments on Google Cloud Platform.</p>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h3>
<ol>
<li><strong>Deploy Applications</strong>: Use the cluster to deploy your containerized applications</li>
<li><strong>Set Up CI/CD</strong>: Integrate with Google Cloud Build or other CI/CD systems</li>
<li><strong>Implement GitOps</strong>: Consider using tools like Flux or ArgoCD for GitOps workflows</li>
<li><strong>Advanced Networking</strong>: Explore service mesh solutions like Istio</li>
<li><strong>Cost Optimization</strong>: Implement cluster autoscaling and resource optimization</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_vU8F" id="additional-resources">Additional Resources<a href="#additional-resources" class="hash-link" aria-label="Direct link to Additional Resources" title="Direct link to Additional Resources" translate="no">​</a></h3>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs" target="_blank" rel="noopener noreferrer">GKE Documentation</a></li>
<li><a href="https://kubernetes.io/docs/" target="_blank" rel="noopener noreferrer">Kubernetes Documentation</a></li>
<li><a href="https://cloud.google.com/architecture" target="_blank" rel="noopener noreferrer">Google Cloud Architecture Center</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/best-practices" target="_blank" rel="noopener noreferrer">GKE Best Practices</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/tamnk74/fullstack-dev/tree/main/docs-site/docs/devops/gcp/gke-cluster-setup.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_oUsg" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_nFFz"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/fullstack-dev/docs/devops/gcp/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Google Cloud Platform (GCP) DevOps Guides</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/fullstack-dev/docs/devops/gcp/gke-ingress-setup"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GKE Ingress Setup Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_dfCb thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of Contents</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#gke-cluster-types" class="table-of-contents__link toc-highlight">GKE Cluster Types</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#required-tools" class="table-of-contents__link toc-highlight">Required Tools</a></li><li><a href="#installation-commands" class="table-of-contents__link toc-highlight">Installation Commands</a></li><li><a href="#gcp-account-setup" class="table-of-contents__link toc-highlight">GCP Account Setup</a></li></ul></li><li><a href="#initial-setup" class="table-of-contents__link toc-highlight">Initial Setup</a><ul><li><a href="#step-1-enable-required-apis" class="table-of-contents__link toc-highlight">Step 1: Enable Required APIs</a></li><li><a href="#step-2-set-default-configuration" class="table-of-contents__link toc-highlight">Step 2: Set Default Configuration</a></li><li><a href="#step-3-create-service-account-optional-but-recommended" class="table-of-contents__link toc-highlight">Step 3: Create Service Account (Optional but Recommended)</a></li></ul></li><li><a href="#terraform-setup" class="table-of-contents__link toc-highlight">Terraform Setup</a><ul><li><a href="#prerequisites-for-terraform" class="table-of-contents__link toc-highlight">Prerequisites for Terraform</a></li><li><a href="#basic-terraform-configuration" class="table-of-contents__link toc-highlight">Basic Terraform Configuration</a></li><li><a href="#vpc-network-module" class="table-of-contents__link toc-highlight">VPC Network Module</a></li><li><a href="#gke-cluster-module" class="table-of-contents__link toc-highlight">GKE Cluster Module</a></li><li><a href="#main-terraform-configuration" class="table-of-contents__link toc-highlight">Main Terraform Configuration</a></li><li><a href="#terraform-variables-file" class="table-of-contents__link toc-highlight">Terraform Variables File</a></li><li><a href="#outputs-configuration" class="table-of-contents__link toc-highlight">Outputs Configuration</a></li><li><a href="#deployment-instructions" class="table-of-contents__link toc-highlight">Deployment Instructions</a></li><li><a href="#environment-specific-configurations" class="table-of-contents__link toc-highlight">Environment-Specific Configurations</a></li><li><a href="#terraform-best-practices" class="table-of-contents__link toc-highlight">Terraform Best Practices</a></li><li><a href="#cleanup" class="table-of-contents__link toc-highlight">Cleanup</a></li></ul></li><li><a href="#cluster-creation-options" class="table-of-contents__link toc-highlight">Cluster Creation Options</a><ul><li><a href="#comparison-standard-vs-autopilot" class="table-of-contents__link toc-highlight">Comparison: Standard vs Autopilot</a></li><li><a href="#when-to-choose-standard-gke" class="table-of-contents__link toc-highlight">When to Choose Standard GKE</a></li><li><a href="#when-to-choose-autopilot-gke" class="table-of-contents__link toc-highlight">When to Choose Autopilot GKE</a></li></ul></li><li><a href="#standard-gke-cluster-setup" class="table-of-contents__link toc-highlight">Standard GKE Cluster Setup</a><ul><li><a href="#basic-standard-cluster" class="table-of-contents__link toc-highlight">Basic Standard Cluster</a></li><li><a href="#production-ready-standard-cluster" class="table-of-contents__link toc-highlight">Production-Ready Standard Cluster</a></li><li><a href="#advanced-standard-cluster-configuration" class="table-of-contents__link toc-highlight">Advanced Standard Cluster Configuration</a></li></ul></li><li><a href="#autopilot-gke-cluster-setup" class="table-of-contents__link toc-highlight">Autopilot GKE Cluster Setup</a><ul><li><a href="#basic-autopilot-cluster" class="table-of-contents__link toc-highlight">Basic Autopilot Cluster</a></li><li><a href="#production-autopilot-cluster" class="table-of-contents__link toc-highlight">Production Autopilot Cluster</a></li></ul></li><li><a href="#node-pool-configuration" class="table-of-contents__link toc-highlight">Node Pool Configuration</a><ul><li><a href="#create-additional-node-pools" class="table-of-contents__link toc-highlight">Create Additional Node Pools</a></li><li><a href="#node-pool-management" class="table-of-contents__link toc-highlight">Node Pool Management</a></li></ul></li><li><a href="#security-configuration" class="table-of-contents__link toc-highlight">Security Configuration</a><ul><li><a href="#workload-identity-setup" class="table-of-contents__link toc-highlight">Workload Identity Setup</a></li><li><a href="#network-security" class="table-of-contents__link toc-highlight">Network Security</a></li><li><a href="#pod-security-standards" class="table-of-contents__link toc-highlight">Pod Security Standards</a></li></ul></li><li><a href="#networking-configuration" class="table-of-contents__link toc-highlight">Networking Configuration</a><ul><li><a href="#vpc-native-networking" class="table-of-contents__link toc-highlight">VPC-Native Networking</a></li><li><a href="#private-cluster-configuration" class="table-of-contents__link toc-highlight">Private Cluster Configuration</a></li><li><a href="#network-policies" class="table-of-contents__link toc-highlight">Network Policies</a></li></ul></li><li><a href="#monitoring-and-logging" class="table-of-contents__link toc-highlight">Monitoring and Logging</a><ul><li><a href="#enable-monitoring-and-logging" class="table-of-contents__link toc-highlight">Enable Monitoring and Logging</a></li><li><a href="#configure-custom-monitoring" class="table-of-contents__link toc-highlight">Configure Custom Monitoring</a></li><li><a href="#log-aggregation-setup" class="table-of-contents__link toc-highlight">Log Aggregation Setup</a></li></ul></li><li><a href="#storage-configuration" class="table-of-contents__link toc-highlight">Storage Configuration</a><ul><li><a href="#persistent-volume-classes" class="table-of-contents__link toc-highlight">Persistent Volume Classes</a></li><li><a href="#filestore-csi-driver" class="table-of-contents__link toc-highlight">Filestore CSI Driver</a></li></ul></li><li><a href="#cluster-management" class="table-of-contents__link toc-highlight">Cluster Management</a><ul><li><a href="#connect-to-cluster" class="table-of-contents__link toc-highlight">Connect to Cluster</a></li><li><a href="#cluster-upgrade" class="table-of-contents__link toc-highlight">Cluster Upgrade</a></li><li><a href="#backup-and-disaster-recovery" class="table-of-contents__link toc-highlight">Backup and Disaster Recovery</a></li><li><a href="#resource-quotas" class="table-of-contents__link toc-highlight">Resource Quotas</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#1-security-best-practices" class="table-of-contents__link toc-highlight">1. Security Best Practices</a></li><li><a href="#2-resource-management" class="table-of-contents__link toc-highlight">2. Resource Management</a></li><li><a href="#3-cost-optimization" class="table-of-contents__link toc-highlight">3. Cost Optimization</a></li><li><a href="#4-high-availability" class="table-of-contents__link toc-highlight">4. High Availability</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#common-issues" class="table-of-contents__link toc-highlight">Common Issues</a></li><li><a href="#monitoring-commands" class="table-of-contents__link toc-highlight">Monitoring Commands</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a><ul><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li><li><a href="#additional-resources" class="table-of-contents__link toc-highlight">Additional Resources</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fullstack-dev/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/fullstack-dev/docs/architecture-practices">Architecture Practices</a></li><li class="footer__item"><a class="footer__link-item" href="/fullstack-dev/docs/features">Features</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Development</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fullstack-dev/docs/setup">Setup &amp; Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/fullstack-dev/docs/testing">Testing</a></li><li class="footer__item"><a class="footer__link-item" href="/fullstack-dev/docs/deployment">Deployment</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/fullstack-dev/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tamnk74/fullstack-dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_PqB4"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/tamnk74/fullstack-dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub (Fullstack Dev)<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_PqB4"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Next.js for Production. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>