"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[385],{5741:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var t=s(9729);const r={},l=t.createContext(r);function a(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(l.Provider,{value:n},e.children)}},6933:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"devops/external-secrets-debug-guide","title":"External Secrets Operator - Debug and Installation Guide","description":"Overview","source":"@site/docs/devops/external-secrets-debug-guide.md","sourceDirName":"devops","slug":"/devops/external-secrets-debug-guide","permalink":"/fullstack-dev/docs/devops/external-secrets-debug-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/tamnk74/fullstack-dev/tree/main/docs-site/docs/devops/external-secrets-debug-guide.md","tags":[],"version":"current","frontMatter":{}}');var r=s(5813),l=s(5741);const a={},c="External Secrets Operator - Debug and Installation Guide",i={},o=[{value:"Overview",id:"overview",level:2},{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Installation Steps",id:"installation-steps",level:2},{value:"1. Prerequisites",id:"1-prerequisites",level:3},{value:"2. Connect to GKE Cluster",id:"2-connect-to-gke-cluster",level:3},{value:"3. Add External Secrets Helm Repository",id:"3-add-external-secrets-helm-repository",level:3},{value:"4. Install External Secrets Operator",id:"4-install-external-secrets-operator",level:3},{value:"Verification and Health Checks",id:"verification-and-health-checks",level:2},{value:"1. Check Installation Status",id:"1-check-installation-status",level:3},{value:"2. Check Pod Status",id:"2-check-pod-status",level:3},{value:"3. Check Services and Endpoints",id:"3-check-services-and-endpoints",level:3},{value:"4. Verify CRDs Installation",id:"4-verify-crds-installation",level:3},{value:"Common Issues and Troubleshooting",id:"common-issues-and-troubleshooting",level:2},{value:"Issue 1: Installation Failed - Name Already in Use",id:"issue-1-installation-failed---name-already-in-use",level:3},{value:"Issue 2: Pods Not Starting",id:"issue-2-pods-not-starting",level:3},{value:"Issue 3: Webhook Issues",id:"issue-3-webhook-issues",level:3},{value:"Issue 4: RBAC Permissions",id:"issue-4-rbac-permissions",level:3},{value:"Configuration Examples",id:"configuration-examples",level:2},{value:"1. Google Secret Manager SecretStore",id:"1-google-secret-manager-secretstore",level:3},{value:"2. Sample ExternalSecret",id:"2-sample-externalsecret",level:3},{value:"Debugging Commands",id:"debugging-commands",level:2},{value:"1. General Health Check",id:"1-general-health-check",level:3},{value:"2. Controller Logs",id:"2-controller-logs",level:3},{value:"3. Resource Status Check",id:"3-resource-status-check",level:3},{value:"4. Performance and Resource Monitoring",id:"4-performance-and-resource-monitoring",level:3},{value:"Maintenance and Updates",id:"maintenance-and-updates",level:2},{value:"1. Regular Updates",id:"1-regular-updates",level:3},{value:"2. Backup Configuration",id:"2-backup-configuration",level:3},{value:"3. Monitoring and Alerts",id:"3-monitoring-and-alerts",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"external-secrets-operator---debug-and-installation-guide",children:"External Secrets Operator - Debug and Installation Guide"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"This guide provides step-by-step instructions for installing, troubleshooting, and debugging External Secrets Operator on Google Kubernetes Engine (GKE) for the e-commerce platform."}),"\n",(0,r.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#installation-steps",children:"Installation Steps"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#verification-and-health-checks",children:"Verification and Health Checks"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#common-issues-and-troubleshooting",children:"Common Issues and Troubleshooting"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#configuration-examples",children:"Configuration Examples"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#debugging-commands",children:"Debugging Commands"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,r.jsx)(n.h3,{id:"1-prerequisites",children:"1. Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"Ensure you have the following tools installed:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"kubectl"})," configured with cluster access"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"helm"})," v3.x installed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"gcloud"})," CLI configured"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-connect-to-gke-cluster",children:"2. Connect to GKE Cluster"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Connect to your GKE cluster\ngcloud container clusters get-credentials sea1-prod-ecom-gke \\\n  --zone asia-southeast1-a \\\n  --project one-global-ecommerce-prod\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-add-external-secrets-helm-repository",children:"3. Add External Secrets Helm Repository"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Add the External Secrets Helm repository\nhelm repo add external-secrets https://charts.external-secrets.io\n\n# Update Helm repositories\nhelm repo update\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-install-external-secrets-operator",children:"4. Install External Secrets Operator"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Install External Secrets Operator\nhelm install external-secrets \\\n  external-secrets/external-secrets \\\n  -n external-secrets \\\n  --create-namespace\n\n# Alternative: If you need to upgrade existing installation\nhelm upgrade external-secrets \\\n  external-secrets/external-secrets \\\n  -n external-secrets\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),': If you encounter "cannot re-use a name that is still in use" error, use the upgrade command instead.']}),"\n",(0,r.jsx)(n.h2,{id:"verification-and-health-checks",children:"Verification and Health Checks"}),"\n",(0,r.jsx)(n.h3,{id:"1-check-installation-status",children:"1. Check Installation Status"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify Helm installation\nhelm list -n external-secrets\n\n# Expected output:\n# NAME                NAMESPACE           REVISION    UPDATED                 STATUS      CHART                   APP VERSION\n# external-secrets    external-secrets    1           2025-10-16 11:48:22     deployed    external-secrets-0.x.x  v0.x.x\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-check-pod-status",children:"2. Check Pod Status"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check if all pods are running\nkubectl get pods -n external-secrets\n\n# Expected pods:\n# - external-secrets-xxx (main controller)\n# - external-secrets-cert-controller-xxx\n# - external-secrets-webhook-xxx\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-check-services-and-endpoints",children:"3. Check Services and Endpoints"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify services are created\nkubectl get services -n external-secrets\n\n# Check service endpoints\nkubectl get endpoints -n external-secrets\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-verify-crds-installation",children:"4. Verify CRDs Installation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check if Custom Resource Definitions are installed\nkubectl get crd | grep external-secrets\n\n# Expected CRDs:\n# - externalsecrets.external-secrets.io\n# - secretstores.external-secrets.io\n# - clustersecretstores.external-secrets.io\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-issues-and-troubleshooting",children:"Common Issues and Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"issue-1-installation-failed---name-already-in-use",children:"Issue 1: Installation Failed - Name Already in Use"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Error"}),": ",(0,r.jsx)(n.code,{children:"INSTALLATION FAILED: cannot re-use a name that is still in use"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check existing installation\nhelm list -n external-secrets\n\n# Option 1: Upgrade existing installation\nhelm upgrade external-secrets external-secrets/external-secrets -n external-secrets\n\n# Option 2: Uninstall and reinstall\nhelm uninstall external-secrets -n external-secrets\nhelm install external-secrets external-secrets/external-secrets -n external-secrets --create-namespace\n"})}),"\n",(0,r.jsx)(n.h3,{id:"issue-2-pods-not-starting",children:"Issue 2: Pods Not Starting"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Pods stuck in ",(0,r.jsx)(n.code,{children:"Pending"}),", ",(0,r.jsx)(n.code,{children:"ContainerCreating"}),", or ",(0,r.jsx)(n.code,{children:"CrashLoopBackOff"})," state"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Debug Steps"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check pod events\nkubectl describe pods -n external-secrets\n\n# Check pod logs\nkubectl logs -n external-secrets deployment/external-secrets\nkubectl logs -n external-secrets deployment/external-secrets-cert-controller\nkubectl logs -n external-secrets deployment/external-secrets-webhook\n\n# Check resource constraints\nkubectl top pods -n external-secrets\nkubectl describe nodes\n"})}),"\n",(0,r.jsx)(n.h3,{id:"issue-3-webhook-issues",children:"Issue 3: Webhook Issues"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": ExternalSecrets not syncing, admission webhook errors"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Debug Steps"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check webhook configuration\nkubectl get validatingwebhookconfiguration | grep external-secrets\nkubectl get mutatingwebhookconfiguration | grep external-secrets\n\n# Check webhook service\nkubectl get service -n external-secrets external-secrets-webhook\n\n# Verify webhook certificates\nkubectl get secret -n external-secrets\n"})}),"\n",(0,r.jsx)(n.h3,{id:"issue-4-rbac-permissions",children:"Issue 4: RBAC Permissions"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Symptoms"}),": Permission denied errors in logs"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Debug Steps"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check RBAC resources\nkubectl get clusterrole | grep external-secrets\nkubectl get clusterrolebinding | grep external-secrets\nkubectl get serviceaccount -n external-secrets\n\n# Verify permissions\nkubectl auth can-i --list --as=system:serviceaccount:external-secrets:external-secrets\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,r.jsx)(n.h3,{id:"1-google-secret-manager-secretstore",children:"1. Google Secret Manager SecretStore"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1beta1\nkind: SecretStore\nmetadata:\n  name: gcpsm-secret-store\n  namespace: prod-env\nspec:\n  provider:\n    gcpsm:\n      projectId: 'one-global-ecommerce-prod'\n      auth:\n        workloadIdentity:\n          clusterLocation: asia-southeast1-a\n          clusterName: sea1-prod-ecom-gke\n          serviceAccountRef:\n            name: external-secrets-sa\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-sample-externalsecret",children:"2. Sample ExternalSecret"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: app-secrets\n  namespace: prod-env\nspec:\n  refreshInterval: 1h\n  secretStoreRef:\n    name: gcpsm-secret-store\n    kind: SecretStore\n  target:\n    name: app-secrets\n    creationPolicy: Owner\n  data:\n    - secretKey: database-url\n      remoteRef:\n        key: database-url\n    - secretKey: jwt-secret\n      remoteRef:\n        key: jwt-secret\n"})}),"\n",(0,r.jsx)(n.h2,{id:"debugging-commands",children:"Debugging Commands"}),"\n",(0,r.jsx)(n.h3,{id:"1-general-health-check",children:"1. General Health Check"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Complete health check script\nkubectl get all -n external-secrets\nkubectl get crd | grep external-secrets\nkubectl get events -n external-secrets --sort-by='.lastTimestamp'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-controller-logs",children:"2. Controller Logs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Main controller logs\nkubectl logs -n external-secrets -l app.kubernetes.io/name=external-secrets -f\n\n# Cert controller logs\nkubectl logs -n external-secrets -l app.kubernetes.io/name=external-secrets-cert-controller -f\n\n# Webhook logs\nkubectl logs -n external-secrets -l app.kubernetes.io/name=external-secrets-webhook -f\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-resource-status-check",children:"3. Resource Status Check"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check SecretStore status\nkubectl get secretstore -A\nkubectl describe secretstore <secretstore-name> -n <namespace>\n\n# Check ExternalSecret status\nkubectl get externalsecret -A\nkubectl describe externalsecret <externalsecret-name> -n <namespace>\n\n# Check generated secrets\nkubectl get secrets -A | grep external-secrets\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-performance-and-resource-monitoring",children:"4. Performance and Resource Monitoring"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Resource usage\nkubectl top pods -n external-secrets\nkubectl describe limits -n external-secrets\n\n# Network connectivity\nkubectl exec -n external-secrets deployment/external-secrets -- nslookup secretmanager.googleapis.com\nkubectl exec -n external-secrets deployment/external-secrets -- curl -I https://secretmanager.googleapis.com\n"})}),"\n",(0,r.jsx)(n.h2,{id:"maintenance-and-updates",children:"Maintenance and Updates"}),"\n",(0,r.jsx)(n.h3,{id:"1-regular-updates",children:"1. Regular Updates"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Update Helm repository\nhelm repo update\n\n# Check for new versions\nhelm search repo external-secrets/external-secrets\n\n# Upgrade to latest version\nhelm upgrade external-secrets external-secrets/external-secrets -n external-secrets\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-backup-configuration",children:"2. Backup Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Export current configuration\nhelm get values external-secrets -n external-secrets > external-secrets-values.yaml\n\n# Backup custom resources\nkubectl get secretstore -A -o yaml > secretstores-backup.yaml\nkubectl get externalsecret -A -o yaml > externalsecrets-backup.yaml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-monitoring-and-alerts",children:"3. Monitoring and Alerts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check metrics endpoint (if enabled)\nkubectl port-forward -n external-secrets service/external-secrets 8080:8080\ncurl http://localhost:8080/metrics\n\n# Monitor events\nkubectl get events -n external-secrets --watch\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Resource Limits"}),": Always set appropriate resource limits and requests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RBAC"}),": Follow principle of least privilege for service accounts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Secrets Rotation"}),": Implement regular secret rotation policies"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring"}),": Set up monitoring and alerting for External Secrets components"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backup"}),": Regularly backup configurations and critical secrets"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Testing"}),": Test secret synchronization in staging before production"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://external-secrets.io/",children:"External Secrets Official Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://external-secrets.io/v0.9.0/provider/google-secrets-manager/",children:"Google Secret Manager Integration"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"../security-practices/kubernetes-secrets-management",children:"Kubernetes Secrets Best Practices"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"./devsecops-pipeline-setup",children:"DevSecOps Pipeline Setup"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:"Last updated: October 16, 2025"}),"\n",(0,r.jsx)(n.em,{children:"Environment: GKE sea1-prod-ecom-gke"}),"\n",(0,r.jsx)(n.em,{children:"Project: one-global-ecommerce-prod"})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);